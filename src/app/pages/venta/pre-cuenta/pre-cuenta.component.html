<div class="header-container">
    <div class="header-titles">
        <h1>Despachos</h1>
        <p class="subtitle">Gestión de delivery y entregas</p>
    </div>

    <div class="header-actions">
        <div class="search-wrapper">
            <i class="bi bi-search search-icon"></i>
            <input type="text" class="noir-input" (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                placeholder="Buscar por código o cliente..." />
        </div>

        <button class="button-add" (click)="openCreate()">
            <i class="bi bi-plus-lg"></i>
            <span>Nuevo Delivery</span>
        </button>
    </div>
</div>

<div class="card shadow-noir">
    <p-table #dt [value]="pedidosActivos()" [rows]="10" [paginator]="true" responsiveLayout="stack"
        [breakpoint]="'960px'" [globalFilterFields]="['codigoPedido', 'nombreCliente']"
        styleClass="p-datatable-sm noir-table">

        <ng-template pTemplate="header">
            <tr>
                <th>CÓDIGO</th>
                <th>CLIENTE</th>
                <th>ESTADO</th>
                <th class="text-right">TOTAL</th>
                <th class="text-center">ACCIONES</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-pedido>
            <tr>
                <td>
                    <span class="doc-badge">{{ pedido.codigoPedido }}</span>
                </td>
                <td>
                    <span class="font-bold">{{ pedido.nombreCliente || 'CLIENTE GENERAL' }}</span>
                </td>
                <td>
                    <span class="status-badge">{{ pedido.estado }}</span>
                </td>
                <td class="text-right">
                    <span class="font-bold">S/ {{ pedido.totalFinal | number:'1.2-2' }}</span>
                </td>
                <td>
                    <div class="flex justify-content-center gap-2">
                        <button class="button-action edit" (click)="verDetalle(pedido)" pTooltip="Ver Detalle">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button class="button-action delete" pTooltip="Eliminar">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5" class="empty-state">
                    NO SE ENCONTRARON PEDIDOS ACTIVOS
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<app-pre-cuenta-modal [(visible)]="displayModal" [sucursalId]="sucursalId()!" [usuarioId]="usuarioId()!"
    [modo]="modalMode()" [pedidoId]="selectedPedidoId()" (onSave)="loadDeliveries()">
</app-pre-cuenta-modal>