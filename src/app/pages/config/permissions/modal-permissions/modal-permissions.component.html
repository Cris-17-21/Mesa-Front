<p-dialog [header]="permissionToEdit ? 'Editar Permiso' : 'Nuevo Permiso'" [(visible)]="visible" [modal]="true"
    [style]="{ width: '30rem', maxWidth: '80vw' }"
    [contentStyle]="{ 'max-height': '75vh', 'overflow-y': 'auto', 'padding': '1.5rem' }" (onHide)="close()"
    [draggable]="false">

    <form [formGroup]="permissionForm" (ngSubmit)="save()" class="form-container">

        <div class="field">
            <label class="label-noir">Nombre del Permiso</label>
            <input pInputText formControlName="name" class="noir-input uppercase-input"
                [class.input-error]="permissionForm.get('name')?.invalid && permissionForm.get('name')?.touched"
                placeholder="Ej: CREATE_EMPRESA" />
            <small class="error-text"
                *ngIf="permissionForm.get('name')?.invalid && permissionForm.get('name')?.touched">
                El nombre es obligatorio (mín. 3 caracteres).
            </small>
        </div>

        <div class="field">
            <label class="label-noir">Módulo</label>
            <p-select [options]="modules()" formControlName="moduleId" optionLabel="name" optionValue="id"
                [filter]="true" filterBy="name" filterPlaceholder="Buscar un módulo" placeholder="Seleccion un módulo"
                class="w-full" appendTo="body"
                [class.ng-dirty]="permissionForm.get('moduleId')?.invalid && permissionForm.get('moduleId')?.touched">
            </p-select>
            <small class="error-text"
                *ngIf="permissionForm.get('moduleId')?.invalid && permissionForm.get('moduleId')?.touched">
                Debes asignar este permiso a un módulo.
            </small>
        </div>

        <div class="field">
            <label class="label-noir">Descripción</label>
            <textarea pTextarea formControlName="description" rows="3" class="noir-input"
                [class.input-error]="permissionForm.get('description')?.invalid && permissionForm.get('description')?.touched"
                placeholder="¿Qué permite hacer este permiso?"></textarea>
            <small class="error-text"
                *ngIf="permissionForm.get('description')?.invalid && permissionForm.get('description')?.touched">
                La descripción es necesaria para el equipo.
            </small>
        </div>

        <div class="footer-actions">
            <button type="button" class="btn-cancel" (click)="close()">Cancelar</button>
            <button type="submit" class="btn-save" [disabled]="loading()" (keyup.enter)="save()">
                {{ loading() ? 'Procesando...' : 'Guardar' }}
            </button>
        </div>
    </form>
</p-dialog>